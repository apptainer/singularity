#!/bin/bash -ex

if [ -z "$OS_TYPE" ]; then
    # default is ubuntu
    exit
fi

sudo mkdir -p /etc/systemd/system/docker.service.d
sudo echo "[Service]"  >> /etc/systemd/system/docker.service.d/docker.conf
sudo echo "ExecStart=" >> /etc/systemd/system/docker.service.d/docker.conf
sudo echo "ExecStart=/usr/bin/dockerd -H tcp://127.0.0.1:2375 -H unix:///var/run/docker.sock -s devicemapper" >> /etc/systemd/system/docker.service.d/docker.conf

sudo apt-get update
sudo systemctl daemon-reload
sudo service docker restart
sleep 5
if [[ "$OS_TYPE" = "opensuse" ]]; then
    DOCKER_HUB_URI="${OS_TYPE}/leap:$OS_VERSION"
else
    DOCKER_HUB_URI="${OS_TYPE}:$OS_VERSION"
fi
sudo docker pull "$DOCKER_HUB_URI"
