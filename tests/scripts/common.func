# generic functions

expect-failure() {
    expect-exit 1 "$@"
}

expect-success() {
    expect-exit 0 "$@"
}

stdout-contains() {
    expect-search output "$@"
}

stderr-contains() {
    expect-search error "$@"
}

test-match() {
    expect-exit 0 $1 /bin/sh -c "[ \"$2\" = \"$3\" ]"
}

get-test-image() {
    image="${TESTDIR}/test.sif"

    if [ ! -f "${image}" ]; then
        definition="${SOURCEDIR}/e2e/testdata/Singularity"
        output=`sudo singularity build -F ${image} ${definition} 2>&1`
        if [ "$?" != 0 ]; then
            test-error "failed to build image ${image}: ${output}"
            exit 1
        fi
    fi

    echo ${image}
}