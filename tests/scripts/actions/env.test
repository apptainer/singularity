#!/singularity/test
# run tests

source ${SOURCEDIR}/tests/scripts/common.func

default_image="docker://alpine:3.8"
default_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"

custom_image="docker://godlovedc/lolcow"
custom_path="/usr/games:${default_path}"
partial_path="/foo"
overwritten_path="/usr/bin:/bin"

stdout-contains "DefaultPath"           "${default_path}"                   singularity exec ${default_image} printenv PATH
stdout-contains "CustomPath"            "${custom_path}"                    singularity exec ${custom_image} printenv PATH

export SINGULARITYENV_APPEND_PATH=${partial_path}
stdout-contains "AppendToDefaultPath"   "${default_path}:${partial_path}"   singularity exec ${default_image} printenv PATH
stdout-contains "AppendToCustomPath"    "${custom_path}:${partial_path}"    singularity exec ${custom_image} printenv PATH
unset SINGULARITYENV_APPEND_PATH

export SINGULARITYENV_PREPEND_PATH=${partial_path}
stdout-contains "PrependToDefaultPath"  "${partial_path}:${default_path}"   singularity exec ${default_image} printenv PATH
stdout-contains "PrependToCustomPath"   "${partial_path}:${custom_path}"    singularity exec ${custom_image} printenv PATH
unset SINGULARITYENV_PREPEND_PATH

export SINGULARITYENV_PATH=${overwritten_path}
stdout-contains "OverwriteDefaultPath"  "${overwritten_path}"               singularity exec ${default_image} printenv PATH
stdout-contains "OverwriteCustomPath"   "${overwritten_path}"               singularity exec ${custom_image} printenv PATH
unset SINGULARITYENV_PATH