#!/singularity/test
# Run multiple instances

source common.func
source instance/instance.func

# stop all instances at exit
atexit() {
    stop-instances
}

register-exit-func atexit

image=`get-test-image`
port=${instance_default_port}

for i in $(seq 1 10); do
    instance_name=`gen-instance-name`
    expect-success "StartInstance${i}" singularity instance start ${image} ${instance_name} ${port}
    ((port++))
done

port=${instance_default_port}

for i in $(seq 1 10); do
    echo-instance  "EchoInstance${i}" ${port}
    ((port++))
done
