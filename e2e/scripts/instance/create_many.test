#!/singularity/test
# Run multiple instances

source common.func
source instance/instance.func

image=`get-test-image`
instance_name=`gen-instance-name`

for i in $(seq 1 10); do
    arg="${SCRIPT_TESTDIR}/${instance_name}_${i}"
    expect-success "StartInstance${i}" singularity instance start ${image} "${instance_name}_${i}" "${arg}"
done

for i in $(seq 1 10); do
    echo-instance  "EchoInstance${i}" `get-echo-port "${instance_name}_${i}"`
    expect-success "StopInstance${i}" singularity instance stop "${instance_name}_${i}"
done
