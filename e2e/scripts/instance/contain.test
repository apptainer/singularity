#!/singularity/test
# Check instance with workdir/contain options

source common.func
source instance/instance.func

image=`get-test-image`
instance_name=`gen-instance-name`
workdir=`mktmpdir`
testfile="/tmp/a_file"

options="--workdir ${workdir} --contain"

expect-success "StartInstance"          singularity instance start ${options} ${image} ${instance_name}
expect-success "CreateContainerFile"    singularity exec instance://${instance_name} touch ${testfile}
expect-success "StopInstance"           singularity instance stop ${instance_name}
expect-failure "CheckContainerFile"     test -f ${testfile}