language: go

sudo: required
dist: trusty

go:
  - "1.10.x"

addons:
  apt:
    packages:
      - flawfinder
      - squashfs-tools
      - uuid-dev
      - libuuid1
      - libssl-dev
      - libssl1.0.0
      - libarchive-dev
      - libgpgme11-dev

before_install:
  - curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh
  - export PATH="${GOPATH}/bin:${PATH}"
  - dep ensure -vendor-only

install:
  - ./mconfig -b ./buildtree -p /usr/local
  - make -j `nproc 2>/dev/null || echo 1` -C ./buildtree
  - sudo make -C ./buildtree install

script:
  - test -z $(go fmt ./...)
  - go vet -all ./...
  - go test ./tests/
